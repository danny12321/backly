import{F as l,K as f,O as u,j as p,o,q as m,t as c,v as g,wb as d,xb as v}from"./chunk-L6HY7YD5.js";var y=class n{http=u(v);configs=[];azureDevOpsConfigsKey="azureDevOpsConfigs";constructor(){this.configs=this.loadConfig()??[]}loadConfig(){let e=localStorage.getItem(this.azureDevOpsConfigsKey);return e?JSON.parse(e):null}addConfig(e){this.configs.push(e),this.saveConfig()}deleteConfig(e){this.configs.splice(e,1),this.saveConfig()}saveConfig(){localStorage.setItem(this.azureDevOpsConfigsKey,JSON.stringify(this.configs))}GetWorkItems(){return c(this.configs.map(s=>this.getWorkItemsForConfig(s))).pipe(o(s=>s.map(r=>r.result.map(t=>({id:t.id.toString(),title:t.fields["System.Title"],state:t.fields["System.State"],assignedTo:t.fields["System.AssignedTo"]?.displayName||"Unassigned",organization:r.organization,project:r.project,type:t.fields["System.WorkItemType"],url:`https://dev.azure.com/${r.organization}/${r.project}/_workitems/edit/${t.id}`,content:t.fields["System.Description"]||""}))).flat()))}getWorkItemsForConfig(e){let s=new d({Authorization:`Basic ${btoa(":"+e.personalAccessToken)}`,Accept:"application/json"}),r=`https://dev.azure.com/${e.organization}/${e.project}/_apis/wit/wiql?api-version=7.1`,t={query:`Select [System.Id]
              From WorkItems
              Where [System.TeamProject] = "${e.project}"
                And [System.State] IN ("Active", "New")
                AND [System.WorkItemType] IN ("User Story", "Bug")`};return this.http.post(r,t,{headers:s}).pipe(l(I=>{let a=I.workItems?.map(i=>i.id)??[];return a.length?p(a).pipe(g(200)).pipe(o(i=>{let S=i.join(","),h=`https://dev.azure.com/${e.organization}/${e.project}/_apis/wit/workitems?ids=${S}&$expand=relations&api-version=7.1`;return this.http.get(h,{headers:s})}),m(i=>i),o(i=>({organization:e.organization,project:e.project,result:i.value}))):[]}))}static \u0275fac=function(s){return new(s||n)};static \u0275prov=f({token:n,factory:n.\u0275fac,providedIn:"root"})};export{y as a};
