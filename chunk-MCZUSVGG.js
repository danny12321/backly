import{C as g,H as m,L as f,lb as u,mb as d,o as a,q as l,t as p}from"./chunk-K2UETTGN.js";var v=class i{http=f(d);configs=[];azureDevOpsConfigsKey="azureDevOpsConfigs";constructor(){this.configs=this.loadConfig()??[]}loadConfig(){let e=localStorage.getItem(this.azureDevOpsConfigsKey);return e?JSON.parse(e):null}addConfig(e){this.configs.push(e),this.saveConfig()}deleteConfig(e){this.configs.splice(e,1),this.saveConfig()}saveConfig(){localStorage.setItem(this.azureDevOpsConfigsKey,JSON.stringify(this.configs))}GetWorkItems(){let e=this.configs.map(o=>this.getWorkItemsForConfig(o));return p(e).pipe(a(o=>o.flat().map(r=>r.result.map(s=>({id:s.id.toString(),title:s.fields["System.Title"],state:s.fields["System.State"],assignedTo:s.fields["System.AssignedTo"]?.displayName||"Unassigned",organization:r.organization,project:r.project,type:s.fields["System.WorkItemType"],url:`https://dev.azure.com/${r.organization}/${r.project}/_workitems/edit/${s.id}`,content:s.fields["System.Description"]||""}))).flat()))}getWorkItemsForConfig(e){let o=new u({Authorization:`Basic ${btoa(":"+e.personalAccessToken)}`,Accept:"application/json"}),r=`https://dev.azure.com/${e.organization}/${e.project}/_apis/wit/wiql?api-version=7.1`,s={query:`Select [System.Id]
              From WorkItems
              Where [System.TeamProject] = "${e.project}"
                And [System.State] IN ("Active", "New")
                AND [System.WorkItemType] = "User Story"`};return console.log("Fetching work items for config:",e),this.http.post(r,s,{headers:o}).pipe(g(h=>{let n=h.workItems?.map(t=>t.id)??[];if(!n.length)return[];let c=[];for(let t=0;t<n.length;t+=200)c.push(n.slice(t,t+200));let y=c.map(t=>{let I=t.join(","),k=`https://dev.azure.com/${e.organization}/${e.project}/_apis/wit/workitems?ids=${I}&$expand=relations&api-version=7.1`;return this.http.get(k,{headers:o}).pipe(a(S=>({result:S.value,organization:e.organization,project:e.project})))});return p(y).pipe(l(t=>t))}))}static \u0275fac=function(o){return new(o||i)};static \u0275prov=m({token:i,factory:i.\u0275fac,providedIn:"root"})};export{v as a};
